<!DOCTYPE html>
<html>
<head>
  <title>PracticeBase Dashboard</title>
</head>
<body>
  <h1>Welcome to PracticeBase</h1>
  <div id="profile"></div>

  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.13/auth0-spa-js.production.js"></script>
  <script>
    (async () => {
      const auth0 = await createAuth0Client({
        domain: 'dev-u02qa30kbpey0ouq.us.auth0.com',
        client_id: 'RFOzZm4QqUpgCyWdNW1jftcja6tPCGoz',
        redirect_uri: "https://therealduckers.github.io/PracticeBase/dashboard.html"
      });

      // Handle redirect callback if returning from Auth0
      if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
        await auth0.handleRedirectCallback();
        window.history.replaceState({}, document.title, '/dashboard.html');
      }

      const isAuthenticated = await auth0.isAuthenticated();

      if (!isAuthenticated) {
        // Redirect to login if not authenticated
        await auth0.loginWithRedirect();
        return;
      }

      // If authenticated, show user profile
      const user = await auth0.getUser();
      document.getElementById('profile').innerHTML = `
        <p>Logged in as: ${user.name}</p>
        <p>Email: ${user.email}</p>
        <button onclick="logout()">Log Out</button>
      `;

      window.logout = () => {
        auth0.logout({ returnTo: window.location.origin });
      };
    })();
  </script>
</body>
</html>
